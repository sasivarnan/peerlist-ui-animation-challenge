import{a as r,k as E}from"./index-4QZcGjhH.js";import{M as A,u as k,P as S,o as W,q as D,L as H}from"./proxy-BpoiGc05.js";function z(n){var s,e,t="";if(typeof n=="string"||typeof n=="number")t+=n;else if(typeof n=="object")if(Array.isArray(n)){var c=n.length;for(s=0;s<c;s++)n[s]&&(e=z(n[s]))&&(t&&(t+=" "),t+=e)}else for(e in n)n[e]&&(t&&(t+=" "),t+=e);return t}function O(){for(var n,s,e=0,t="",c=arguments.length;e<c;e++)(n=arguments[e])&&(s=z(n))&&(t&&(t+=" "),t+=s);return t}class K extends r.Component{getSnapshotBeforeUpdate(s){const e=this.props.childRef.current;if(e&&s.isPresent&&!this.props.isPresent){const t=e.offsetParent,c=t instanceof HTMLElement&&t.offsetWidth||0,o=this.props.sizeRef.current;o.height=e.offsetHeight||0,o.width=e.offsetWidth||0,o.top=e.offsetTop,o.left=e.offsetLeft,o.right=c-o.width-o.left}return null}componentDidUpdate(){}render(){return this.props.children}}function U({children:n,isPresent:s,anchorX:e}){const t=r.useId(),c=r.useRef(null),o=r.useRef({width:0,height:0,top:0,left:0,right:0}),{nonce:h}=r.useContext(A);return r.useInsertionEffect(()=>{const{width:x,height:f,top:m,left:i,right:p}=o.current;if(s||!c.current||!x||!f)return;const a=e==="left"?`left: ${i}`:`right: ${p}`;c.current.dataset.motionPopId=t;const u=document.createElement("style");return h&&(u.nonce=h),document.head.appendChild(u),u.sheet&&u.sheet.insertRule(`
          [data-motion-pop-id="${t}"] {
            position: absolute !important;
            width: ${x}px !important;
            height: ${f}px !important;
            ${a}px !important;
            top: ${m}px !important;
          }
        `),()=>{document.head.removeChild(u)}},[s]),E.jsx(K,{isPresent:s,childRef:c,sizeRef:o,children:r.cloneElement(n,{ref:c})})}const q=({children:n,initial:s,isPresent:e,onExitComplete:t,custom:c,presenceAffectsLayout:o,mode:h,anchorX:x})=>{const f=k(B),m=r.useId(),i=r.useCallback(a=>{f.set(a,!0);for(const u of f.values())if(!u)return;t&&t()},[f,t]),p=r.useMemo(()=>({id:m,initial:s,isPresent:e,custom:c,onExitComplete:i,register:a=>(f.set(a,!1),()=>f.delete(a))}),o?[Math.random(),i]:[e,i]);return r.useMemo(()=>{f.forEach((a,u)=>f.set(u,!1))},[e]),r.useEffect(()=>{!e&&!f.size&&t&&t()},[e]),h==="popLayout"&&(n=E.jsx(U,{isPresent:e,anchorX:x,children:n})),E.jsx(S.Provider,{value:p,children:n})};function B(){return new Map}const M=n=>n.key||"";function $(n){const s=[];return r.Children.forEach(n,e=>{r.isValidElement(e)&&s.push(e)}),s}const T=({children:n,custom:s,initial:e=!0,onExitComplete:t,presenceAffectsLayout:c=!0,mode:o="sync",propagate:h=!1,anchorX:x="left"})=>{const[f,m]=W(h),i=r.useMemo(()=>$(n),[n]),p=h&&!f?[]:i.map(M),a=r.useRef(!0),u=r.useRef(i),g=k(()=>new Map),[L,I]=r.useState(i),[C,w]=r.useState(i);D(()=>{a.current=!1,u.current=i;for(let d=0;d<C.length;d++){const l=M(C[d]);p.includes(l)?g.delete(l):g.get(l)!==!0&&g.set(l,!1)}},[C,p.length,p.join("-")]);const P=[];if(i!==L){let d=[...i];for(let l=0;l<C.length;l++){const y=C[l],v=M(y);p.includes(v)||(d.splice(l,0,y),P.push(y))}return o==="wait"&&P.length&&(d=P),w($(d)),I(i),null}const{forceRender:R}=r.useContext(H);return E.jsx(E.Fragment,{children:C.map(d=>{const l=M(d),y=h&&!f?!1:i===C||p.includes(l),v=()=>{if(g.has(l))g.set(l,!0);else return;let j=!0;g.forEach(b=>{b||(j=!1)}),j&&(R==null||R(),w(u.current),h&&(m==null||m()),t&&t())};return E.jsx(q,{isPresent:y,initial:!a.current||e?void 0:!1,custom:s,presenceAffectsLayout:c,mode:o,onExitComplete:y?void 0:v,anchorX:x,children:d},l)})})};export{T as A,O as c};
